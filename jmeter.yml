jmeter:
  stage: performance
  image:
    name: egaillardon/jmeter-plugins:5.2.1-1.2.0
    entrypoint: [""]
  script:
    - echo "------------------------------------------------------------"
    - echo APP_URL "$APP_URL"
    - echo OPENSHIFT_URL "$OPENSHIFT_URL"
    - echo OPENSHIFT_PROJECT "$OPENSHIFT_PROJECT"
    - echo "------------------------------------------------------------"
    - jmeter -n -t ./jmeter/testFiles/Apizator.jmx -l ./jmeter/results/results.jtl -JHostUrl="$APP_URL"
    - jmeter -g ./jmeter/results/results.jtl -o ./jmeter/reports/jmeter-report
  artifacts:
    name: "${CI_JOB_ID}_${CI_JOB_NAME}"
    expire_in: 1 week
    paths:
      - ./jmeter/results/results.jtl
      - jmeter-report/
  only:
    variables:
      - $ENABLE_JMETER && $APP_URL
  dependencies: []